import{u,a as m,j as n,B as x,M as w,r as j,W as v,c as F,e as W,d as R,h as B,f as E,i as d,H as y,G as b,S as N,g as f}from"./index-10ede70a.js";import{c as A}from"./index-86c7af64.js";import{u as L,M as H,S as P}from"./ModalResultMovies-70eaa99b.js";import"./footer.module-ba78b31a.js";const T=e=>{var s;return((s=e==null?void 0:e.user)==null?void 0:s.id)??""},U=e=>{var s;return((s=e==null?void 0:e.user)==null?void 0:s.isAuth)??!1},z=e=>{var s;return(s=e==null?void 0:e.myCollection)==null?void 0:s.myCollection},O=e=>{var s;return(s=e==null?void 0:e.wantToSee)==null?void 0:s.wantToSee[0]},k=e=>{var s;return(s=e==null?void 0:e.wantToSee)==null?void 0:s.wantToSee},G=A(z,e=>s=>e==null?void 0:e.some(a=>a.id===s)),$="_btn_an570_1",q={btn:$},J=({firstMovie:e})=>{const s=u(),a=m(r=>G(r)(e.id)),c=r=>{s(a?w.removeMovieFromCollection(r):w.addMovieToCollection(r))};return n.jsx(x,{styles:q.btn,handler:()=>c(e),children:a?"Удалить из коллекции":"Добавить в коллекцию"})};function K(e){if(!e)return"";let s=Math.floor(e/60),a=e%60;function c(l){let t=l%10,o=l%100;return o>=11&&o<=14?"минут":t===1?"минута":t>=2&&t<=4?"минуты":"минут"}function r(l){let t=l%10,o=l%100;return o>=11&&o<=14?"часов":t===1?"час":t>=2&&t<=4?"часа":"часов"}let i="";return s>0?(i+=s+" "+r(s),a>0&&(i+=" "+a+" "+c(a))):i+=a+" "+c(a),i}const Q="_wrapperContentCard_16r1g_1",V="_cardImage_16r1g_9",X="_wrapperContent_16r1g_1",Y="_movieInfo_16r1g_24",Z="_movieDescription_16r1g_30",M="_btnsWrapper_16r1g_37",ee="_movieRating_16r1g_46",ne="_btnDelete_16r1g_52",se="_rating_16r1g_70",p={wrapperContentCard:Q,cardImage:V,wrapperContent:X,movieInfo:Y,movieDescription:Z,btnsWrapper:M,movieRating:ee,btnDelete:ne,rating:se},te=j.memo(({firstMovie:e})=>{var l;const s=u(),a=m(T),c=((l=e==null?void 0:e.poster)==null?void 0:l.previewUrl)||(e==null?void 0:e.poster),r=async t=>{s(v.removeMovie(e)),F({movie:t},a,"wantToSee")};let i=typeof e.rating=="object"?n.jsx(n.Fragment,{children:Object.entries(e==null?void 0:e.rating).filter(([t,o])=>o!==null&&o>=0).map(([t,o])=>n.jsxs("strong",{className:p.rating,children:[t,": ",o]},t))}):e.rating;if(!e.length)return n.jsx(n.Fragment,{children:n.jsxs("div",{className:p.wrapperContentCard,children:[n.jsx("img",{className:p.cardImage,src:c}),n.jsxs("div",{className:p.wrapperContent,children:[n.jsxs("div",{className:p.movieInfo,children:[n.jsxs("p",{children:[e.genres.length>1?"Жанры: ":"Жанр: ",e.genres.map(t=>typeof t=="object"?t.name:t)+"."]}),n.jsxs("p",{children:["Название: ",n.jsx("strong",{children:e.name})]}),n.jsxs("p",{children:["Оригинальное название: ",n.jsx("strong",{children:e.alternativeName})]}),n.jsxs("p",{children:[e.countries.length>1?"Страны: ":"Страна: ",e.countries.map(t=>typeof t=="object"?t.name:t)+".",e.year," год"]}),n.jsx("p",{children:e.movieLength>0?"Длительность: "+K(e.movieLength):""}),n.jsx("div",{className:p.movieDescription,children:e.description}),n.jsxs("div",{className:p.btnsWrapper,children:[n.jsx(x,{styles:p.btnDelete,handler:()=>r(e),children:"Удалить из списка"}),n.jsx(J,{firstMovie:e})]})]}),n.jsxs("div",{className:p.movieRating,children:["Rating ",i," "]}),n.jsx("hr",{})]})]})})}),ce=j.memo(()=>{const{isOpened:e,handleModal:s}=W(),a=u(),c=R(),r=m(k),i=m(O),l=m(U),t=m(T),o=B(),{search:_,selectedMovie:C,filteredBySearchMovie:D,setSelectedMovie:h}=L(r,s);j.useEffect(()=>{localStorage.getItem("userEmail")||c(E.home),h(r[r.length-1]&&i)},[i,l,r,c]);const I=async()=>{a(v.clearAll()),f(t,"wantToSee")};return r.length?n.jsxs("section",{className:d.main,children:[n.jsx(H,{movies:D,isOpen:e,onClose:s,handleCard:h}),n.jsx(y,{children:n.jsx(b,{placeholder:"Что найти в коллекции?",handleMovie:_})}),n.jsxs("div",{className:d.wrapper,children:[n.jsx("div",{className:d.wrapperBtn,children:n.jsxs(x,{styles:d.deleteEntireList,handler:()=>I(),children:["Очистить список (",r.length,")"]})}),n.jsx(N,{}),n.jsx("div",{className:d.container,children:C&&n.jsx(te,{firstMovie:C})}),n.jsx(P,{width:"100%",height:"25%",sizeCard:160,snowButtons:!0,itemsPerPage:Math.floor(o/160),position:"absolute",children:r.map(g=>{var S;return n.jsx("img",{className:d.card,src:((S=g.poster)==null?void 0:S.previewUrl)||g.poster,alt:g.title,onClick:()=>h(g)},g.id)})})]})]}):n.jsxs("section",{className:d.main,children:[n.jsx(y,{children:n.jsx(b,{placeholder:"Что найти в коллекции?",handleMovie:_})}),n.jsxs("div",{className:d.emptyWrapper,children:[n.jsx(N,{}),n.jsx("h2",{className:d.emptyPage,children:"Список пуст"})]})]})});export{ce as default};
